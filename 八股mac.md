[ä¸€çœ‹å°±ä¼š Androidæ¡†æ¶DataBindingçš„ä½¿ç”¨ä¸å°è£…Androidä¸­DataBindingçš„å°è£… å…ˆç®€å•çš„ä»‹ç» - æ˜é‡‘](https://juejin.cn/post/7098510891187961869?searchId=20250724103946B0CEE6D560518C803AA9#heading-2) [ç”¨Kotlin Flowè§£å†³Androidå¼€å‘ä¸­çš„ç—›ç‚¹é—®é¢˜æœ¬æ–‡å°†é€šè¿‡å®é™…ä¸šåŠ¡åœºæ™¯é˜è¿°å¦‚ä½•ä½¿ç”¨Kotlin Flowè§£å†³A - æ˜é‡‘](https://juejin.cn/post/7031726493906829319?searchId=20250724161730F3FCC1BCAE2C0BA197C8)

[MVVM è¿›é˜¶ç‰ˆï¼šMVI æ¶æ„äº†è§£ä¸€ä¸‹~MVVMæ¶æ„è¢«å®˜æ–¹æ¨èï¼Œæˆä¸ºAndroidå¼€å‘ä¸­çš„ä¸»æµæ¶æ„ã€‚ä¸è¿‡è½¯ä»¶å¼€å‘ä¸­æ²¡æœ‰é“¶ - æ˜é‡‘](https://juejin.cn/post/7022624191723601928?searchId=20250724211452DE3DCC033022757983EF)

[OkHttpæºç ä¹‹æ·±åº¦è§£æï¼ˆäº”ï¼‰â€”â€”CacheInterceptorè¯¦è§£ï¼šç¼“å­˜æœºåˆ¶â€œæˆ‘æŠ¥åå‚åŠ é‡‘çŸ³è®¡åˆ’1æœŸæŒ‘æˆ˜â€”â€”ç“œåˆ†1 - æ˜é‡‘](https://juejin.cn/post/7142894768539271198)

[Linux è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰æ€»ç»“ - huansky - åšå®¢å›­](https://www.cnblogs.com/huansky/p/13170125.html)

mvi äº‹ä»¶æµé©±åŠ¨ ä»£ç†ç±» å¸é™„ç»„ä»¶ï¼ˆç‚¹å‡»äº‹ä»¶åˆ†å‘æ‹¦æˆªå¤„ç†ï¼Œè‡ªå®šä¹‰viewï¼ˆæ·»åŠ åŠ¨ç”»æ•ˆæœï¼‰ï¼‰ animationåŠ¨ç”»æ•ˆæœ flowæµ rxjava databinding okhttpæ‹¦æˆªå™¨ retrofit disposableè‡ªåŠ¨å¤„ç†rxjavaå…³é—­ eventbusè‡ªåŠ¨æ ¹æ®ç”Ÿå‘½å‘¨æœŸæ³¨å†Œå’Œå–æ¶ˆ mmkv handler webview

æ¡Œé¢å°ç»„ä»¶ï¼šæ”¯æŒçš„viewç§ç±»å°‘ï¼Œä¸”ä¸èƒ½è‡ªå®šä¹‰view

åˆ·æ–°UIï¼š

```javascript
AppWidgetManager.getInstance(context).updateAppWidget(appWidgetIds, remoteViews)
```

ç‚¹å‡»äº‹ä»¶ï¼špendingintent æ·»åŠ 

*ç³»ç»Ÿæ¯æ¬¡è§¦å‘è°ƒç”¨AppWidgetçš„onUpdateåçš„éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ‰€ä»¥ä¸è¦åœ¨AppWidgetProviderä½¿ç”¨å…¨å±€å˜é‡ï¼Œå› ä¸ºå¾ˆæœ‰å¯èƒ½æ‹¿åˆ°nullå¯¹è±¡*

æ¡Œé¢å°ç»„ä»¶çš„æœ¬è´¨æ˜¯ä¸€ä¸ªBroadcastReceiverï¼Œå› æ­¤ï¼Œå°ç»„ä»¶å…·å¤‡BroadcastReceiverçš„æ‰€æœ‰ç‰¹å¾ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨AndroidMenifest.xmlé‡Œé¢æ³¨å†Œå„ç§Actionæ¥å®ç°é€šè®¯ï¼Œå¦å¤–æ¡Œé¢å°ç»„ä»¶åœ¨æ·»åŠ å’Œåˆ é™¤æ—¶ä¼šæœ‰ä¸€äº›ç‰¹å®šçš„Actionçš„äº‹ä»¶è°ƒç”¨ï¼Œå¦‚ä¸‹ï¼š

- a.æ·»åŠ æ–°çš„AppWidgetï¼š  
  1.1.ç¬¬ä¸€ä¸ªAppWidget:ä¼šå…ˆä¾æ¬¡è°ƒç”¨APPWIDGET_ENABLED->APPWIDGET_UPDATE-APPWIDGET_UPDATE_OPTIONS  
  1.2.æ·»åŠ ç¬¬äºŒä¸ªAppWidgetï¼šä¼šå…ˆä¾æ¬¡è°ƒç”¨APPWIDGET_UPDATE->APPWIDGET_UPDATE_OPTIONS

- b.åˆ é™¤AppWidget  
  2.1.éæœ€åä¸€ä¸ªç›¸åŒAppWidgetï¼šä¼šå…ˆè°ƒç”¨APPWIDGET_DELETED  
  2.2.æœ€åä¸€ä¸ªç›¸åŒAppWidgetï¼šä¼šå…ˆä¾æ¬¡è°ƒç”¨APPWIDGET_DELETED->APPWIDGET_DISABLED

- c.ç³»ç»Ÿè‡ªåŠ¨æ›´æ–°AppWidgetï¼šä¼šè°ƒç”¨APPWIDGET_UPDATE

å°ç»„ä»¶å†…å¯åŠ¨å‰å°æœåŠ¡

è‡ªåŠ¨æ‹†è£…ç®±ï¼šé›†åˆç±»å‹åªèƒ½å­˜å‚¨å¯¹è±¡ç±»å‹çš„æ•°æ®ï¼Œè€ŒåŸºæœ¬æ•°æ®ç±»å‹ä¸èƒ½ç›´æ¥ä½œä¸ºé›†åˆå…ƒç´ 

åŸå­æ€§ï¼Œå¯è§æ€§ï¼Œä¸€è‡´æ€§

## 1. äº‹ä»¶åˆ†å‘æµç¨‹ç®€è¿°

- è§¦æ‘¸äº‹ä»¶ï¼ˆå¦‚ç‚¹å‡»ã€æ»‘åŠ¨ï¼‰é¦–å…ˆç”± Activity çš„Â `dispatchTouchEvent()`Â æ¥æ”¶ã€‚
- Activity ä¼šå°†äº‹ä»¶ä¼ é€’ç»™å…¶æ ¹ Viewï¼ˆé€šå¸¸æ˜¯ DecorViewï¼‰ã€‚
- æ ¹ Viewï¼ˆViewGroupï¼‰ä¼šè°ƒç”¨è‡ªå·±çš„Â `dispatchTouchEvent()`ï¼Œç„¶åå†³å®šæ˜¯å¦å°†äº‹ä»¶åˆ†å‘ç»™å­ Viewã€‚
- å¦‚æœæ˜¯ ViewGroupï¼Œä¼šéå†å­ Viewï¼Œåˆ¤æ–­äº‹ä»¶æ˜¯å¦è½åœ¨å­ View åŒºåŸŸå†…ï¼Œåªæœ‰**å‘½ä¸­çš„å­ View**æ‰ä¼šæ”¶åˆ°äº‹ä»¶ï¼ˆå³è°ƒç”¨å…¶Â `dispatchTouchEvent()`ï¼‰ã€‚
- å¦‚æœæ˜¯æ™®é€š Viewï¼ˆé ViewGroupï¼‰ï¼Œå°±ç›´æ¥è°ƒç”¨è‡ªå·±çš„Â `onTouchEvent()`ã€‚

---

## 2. ä¸æ˜¯æ‰€æœ‰ View éƒ½ä¼šæ”¶åˆ°äº‹ä»¶

- åªæœ‰**äº‹ä»¶å‘½ä¸­çš„ View**ï¼ˆå³è§¦æ‘¸ç‚¹è½åœ¨è¯¥ View åŒºåŸŸå†…ï¼‰æ‰ä¼šæ”¶åˆ°äº‹ä»¶åˆ†å‘ã€‚
- æ²¡æœ‰å‘½ä¸­çš„ Viewï¼Œ`dispatchTouchEvent()`Â æ ¹æœ¬ä¸ä¼šè¢«è°ƒç”¨ã€‚

---

## 3. åœ¨Â `dispatchTouchEvent()`Â åˆ¤æ–­æ˜¯å¦æ¶ˆè´¹äº‹ä»¶

- æ¯ä¸ªæ”¶åˆ°äº‹ä»¶çš„ View çš„Â `dispatchTouchEvent()`Â éƒ½å¯ä»¥å†³å®šæ˜¯å¦æ¶ˆè´¹äº‹ä»¶ã€‚
- å¦‚æœÂ `dispatchTouchEvent()`Â è¿”å›Â `true`ï¼Œè¡¨ç¤ºäº‹ä»¶è¢«æ¶ˆè´¹ï¼Œä¸å†å‘ä¸‹ä¼ é€’ã€‚
- å¦‚æœè¿”å›Â `false`ï¼Œäº‹ä»¶ä¼šç»§ç»­å‘ä¸Šä¼ é€’ï¼ˆæ¯”å¦‚çˆ¶ View çš„Â `onTouchEvent()`ï¼‰ã€‚

---

æ‰©å¤§viewå“åº”èŒƒå›´

## 1.Â **ä¸ºä»€ä¹ˆè¦åœ¨çˆ¶ View åˆ¤æ–­ï¼Ÿ**

- Android çš„äº‹ä»¶åˆ†å‘æœºåˆ¶å†³å®šäº†ï¼šåªæœ‰è§¦æ‘¸ç‚¹è½åœ¨ View çš„â€œå‘½ä¸­åŒºåŸŸâ€å†…ï¼Œäº‹ä»¶æ‰ä¼šè¢«åˆ†å‘ç»™è¯¥ Viewã€‚
- å¦‚æœä½ æƒ³è®© View å“åº”è¶…å‡ºè‡ªèº« bounds çš„åŒºåŸŸï¼Œ**å¿…é¡»è®©çˆ¶ View å…ˆâ€œæ‹¦æˆªâ€åˆ°è¿™äº›åŒºåŸŸçš„äº‹ä»¶ï¼Œç„¶åæ‰‹åŠ¨åˆ†å‘ç»™ç›®æ ‡ View**ã€‚

---

## 2.Â **å¸¸è§çš„ä¸¤ç§åšæ³•**

### æ–¹å¼ä¸€ï¼šé‡å†™çˆ¶ View çš„Â `dispatchTouchEvent()`

- åœ¨çˆ¶ View çš„Â `dispatchTouchEvent()`Â ä¸­ï¼Œåˆ¤æ–­è§¦æ‘¸ç‚¹æ˜¯å¦åœ¨ä½ å¸Œæœ›çš„â€œæ‰©å±•åŒºåŸŸâ€å†…ã€‚
- å¦‚æœåœ¨æ‰©å±•åŒºåŸŸå†…ï¼Œå¯ä»¥æ‰‹åŠ¨è°ƒç”¨ç›®æ ‡ View çš„Â `dispatchTouchEvent()`Â æˆ–Â `onTouchEvent()`ï¼Œè®©å®ƒå“åº”äº‹ä»¶ã€‚
- è¿™ç§æ–¹å¼éœ€è¦ä½ è‡ªå·±ç®¡ç†äº‹ä»¶çš„åˆ†å‘å’Œæ¶ˆè´¹é€»è¾‘ã€‚

**ç¤ºä¾‹ä¼ªä»£ç ï¼š**

```java
@Override
public boolean dispatchTouchEvent(MotionEvent ev) {
    if (isInExpandedArea(ev.getX(), ev.getY())) {
        // æ‰‹åŠ¨åˆ†å‘ç»™ç›®æ ‡View
        return targetView.dispatchTouchEvent(ev);
    }
    return super.dispatchTouchEvent(ev);
}
```

### æ–¹å¼äºŒï¼šä½¿ç”¨Â `TouchDelegate`ï¼ˆæ¨èï¼‰

- Android å®˜æ–¹æ¨èçš„åšæ³•ã€‚
- åªéœ€åœ¨çˆ¶ View è®¾ç½®ä¸€æ¬¡ TouchDelegateï¼Œä¹‹åçˆ¶ View ä¼šè‡ªåŠ¨å¸®ä½ æŠŠæ‰©å±•åŒºåŸŸçš„äº‹ä»¶åˆ†å‘ç»™ç›®æ ‡ Viewã€‚
- ä»£ç ç®€å•ï¼Œç»´æŠ¤æ€§å¥½ã€‚

**ç¤ºä¾‹ï¼š**

```java
Rect rect = new Rect();
targetView.getHitRect(rect);
rect.inset(-100, -100); // å››å‘¨æ‰©å±•100åƒç´ 
parentView.setTouchDelegate(new TouchDelegate(rect, targetView));
```

---

## 3.Â **åœ¨çˆ¶ View çš„Â `onTouchEvent()`Â é‡Œæ‹¦æˆªå†ä¼ é€’ï¼Ÿ**

- è¿™ç§æ–¹å¼ä¹Ÿå¯è¡Œï¼Œä½†é€šå¸¸ä¸å¦‚åœ¨Â `dispatchTouchEvent()`Â é‡Œå¤„ç†çµæ´»ã€‚
- `onTouchEvent()`Â åªä¼šåœ¨äº‹ä»¶æ²¡æœ‰è¢«å­ View æ¶ˆè´¹æ—¶æ‰è¢«è°ƒç”¨ï¼Œä¸”äº‹ä»¶æµå·²ç»åˆ°äº†çˆ¶ Viewï¼Œæ‰‹åŠ¨å†ä¼ é€’ç»™å­ View å¯èƒ½å¯¼è‡´äº‹ä»¶æµä¸è‡ªç„¶ï¼ˆæ¯”å¦‚ ACTION_DOWN/ACTION_MOVE/ACTION_UP çš„é¡ºåºå’Œå½’å±æ··ä¹±ï¼‰ã€‚
- æ¨èä¼˜å…ˆç”¨Â `dispatchTouchEvent()`Â æˆ–Â `TouchDelegate`ã€‚

---

handler -> Looper -> thread

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â messagequeue -> idlehandler ï¼ˆæ¥å£ï¼‰

## 1. Handler å‘é€æ¶ˆæ¯ï¼ˆå­˜å…¥ MessageQueueï¼‰

å½“ä½ è°ƒç”¨ Handler çš„Â `sendMessage()`ã€`post()`Â ç­‰æ–¹æ³•æ—¶ï¼Œå®é™…ä¸Šæ˜¯å°†ä¸€ä¸ª Message å¯¹è±¡æ’å…¥åˆ° MessageQueue ä¸­ã€‚

**æ ¸å¿ƒæºç æµç¨‹ï¼š**

1. `Handler.sendMessage(msg)`
2. å†…éƒ¨è°ƒç”¨Â `sendMessageAtTime(msg, uptimeMillis)`
3. æœ€ç»ˆè°ƒç”¨Â `MessageQueue.enqueueMessage(msg, uptimeMillis)`

**ç®€åŒ–ä¼ªä»£ç ï¼š**

```java
public boolean sendMessage(Message msg) {
    return sendMessageDelayed(msg, 0);
}

public boolean sendMessageDelayed(Message msg, long delayMillis) {
    return sendMessageAtTime(msg, SystemClock.uptimeMillis() + delayMillis);
}

public boolean sendMessageAtTime(Message msg, long uptimeMillis) {
    MessageQueue queue = mQueue;
    msg.target = this; // è®°å½•æ˜¯å“ªä¸ªHandlerå‘çš„
    return queue.enqueueMessage(msg, uptimeMillis);
}
```

**MessageQueue.enqueueMessage()**  
ä¼šæŠŠ Message æŒ‰æ—¶é—´é¡ºåºæ’å…¥åˆ°é˜Ÿåˆ—ï¼ˆé“¾è¡¨ï¼‰ä¸­ã€‚

---

## 2. Looper å–å‡ºæ¶ˆæ¯å¹¶å¤„ç†

Looper æ˜¯ä¸€ä¸ªå¾ªç¯ä½“ï¼Œå®ƒä¸æ–­ä» MessageQueue å–å‡ºæ¶ˆæ¯ï¼Œå¹¶äº¤ç»™å¯¹åº”çš„ Handler å¤„ç†ã€‚

**æ ¸å¿ƒæºç æµç¨‹ï¼š**

1. Looper.loop() ä¸æ–­è°ƒç”¨Â `queue.next()`Â å–å‡ºä¸‹ä¸€ä¸ª Message
2. å–åˆ° Message åï¼Œè°ƒç”¨Â `msg.target.dispatchMessage(msg)`
3. `dispatchMessage()`Â å†…éƒ¨ä¼šå›è°ƒ Handler çš„Â `handleMessage(msg)`

**ç®€åŒ–ä¼ªä»£ç ï¼š**

```java
public static void loop() {
    for (;;) {
        Message msg = queue.next(); // å–å‡ºæ¶ˆæ¯ï¼ˆé˜»å¡ç­‰å¾…ï¼‰
        if (msg == null) {
            continue;
        }
        msg.target.dispatchMessage(msg); // targetå°±æ˜¯Handler
        msg.recycle();
    }
}
```

---

## 3. Handler å¤„ç†æ¶ˆæ¯

Handler çš„Â `dispatchMessage()`Â ä¼šæ ¹æ®æ¶ˆæ¯ç±»å‹ï¼Œæœ€ç»ˆè°ƒç”¨ä½ çš„Â `handleMessage()`Â æ–¹æ³•ã€‚

**ç®€åŒ–ä¼ªä»£ç ï¼š**

```java
public void dispatchMessage(Message msg) {
    if (msg.callback != null) {
        msg.callback.run();
    } else {
        handleMessage(msg); // ä½ é‡å†™çš„å¤„ç†é€»è¾‘
    }
}
```

---

## 4. æ€»ç»“æµç¨‹å›¾

```
ä½ è°ƒç”¨ Handler.sendMessage(msg)
        â†“
Handler è°ƒç”¨ MessageQueue.enqueueMessage(msg)
        â†“
MessageQueue æŒ‰æ—¶é—´é¡ºåºå­˜å‚¨æ¶ˆæ¯
        â†“
Looper.loop() ä¸æ–­è°ƒç”¨ queue.next() å–å‡ºæ¶ˆæ¯
        â†“
å–åˆ° msg åï¼Œè°ƒç”¨ msg.target.dispatchMessage(msg)
        â†“
Handler.dispatchMessage(msg) â†’ Handler.handleMessage(msg)
```

---

## 5. å…³é”®ç‚¹

- **å­˜å…¥**ï¼šHandler é€šè¿‡ MessageQueue.enqueueMessage() å­˜å…¥æ¶ˆæ¯é˜Ÿåˆ—ã€‚
- **å–å‡º**ï¼šLooper.loop() å¾ªç¯ä» MessageQueue å–å‡ºæ¶ˆæ¯ã€‚
- **å¤„ç†**ï¼šå–å‡ºçš„æ¶ˆæ¯ç”± Handler å¤„ç†ï¼ˆhandleMessageï¼‰ã€‚

---

**ç¡®ä¿æ¯æ¬¡ç©ºé—²åªä¼šå¤„ç†ä¸€éidlehandlerï¼Œå–å‡ºå‰xä¸ªä»»åŠ¡çš„ä»»åŠ¡å¤„ç†**

## 1. åŸºæœ¬æ¦‚å¿µ

- **Binder**ï¼šä¸€ç§åŸºäº C/Sï¼ˆå®¢æˆ·ç«¯/æœåŠ¡ç«¯ï¼‰æ¶æ„çš„ IPC æœºåˆ¶ã€‚
- **ServiceManager**ï¼šBinder æœåŠ¡çš„æ³¨å†Œå’ŒæŸ¥è¯¢ä¸­å¿ƒã€‚
- **Binder é©±åŠ¨**ï¼šå†…æ ¸æ¨¡å—Â `/dev/binder`ï¼Œè´Ÿè´£è·¨è¿›ç¨‹é€šä¿¡çš„å®é™…æ•°æ®ä¼ é€’ã€‚
- **Proxy/Stub**ï¼šAIDL è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç†å’Œæ¡©ä»£ç ï¼Œéšè—åº•å±‚é€šä¿¡ç»†èŠ‚ã€‚

---

## 2. é€šä¿¡æµç¨‹å›¾

```
Clientè¿›ç¨‹
   |   | 1. é€šè¿‡ServiceManageræŸ¥æ‰¾æœåŠ¡   v
ServiceManagerè¿›ç¨‹
   |   | 2. è¿”å›æœåŠ¡çš„Binderä»£ç†å¯¹è±¡   v
Clientè¿›ç¨‹
   |   | 3. é€šè¿‡Binderé©±åŠ¨å‘é€è¯·æ±‚   v
Binderé©±åŠ¨ï¼ˆå†…æ ¸ç©ºé—´ï¼‰
   |   | 4. é€šçŸ¥Serverè¿›ç¨‹æœ‰è¯·æ±‚   v
Serverè¿›ç¨‹
   |   | 5. å¤„ç†è¯·æ±‚ï¼Œè¿”å›ç»“æœ   v
Binderé©±åŠ¨
   |   | 6. è¿”å›ç»“æœç»™Client   v
Clientè¿›ç¨‹
```

---

## 3. å…³é”®æ­¥éª¤è¯¦è§£

### 1. æœåŠ¡æ³¨å†Œ

- æœåŠ¡ç«¯ï¼ˆServerï¼‰å®ç° Binder æ¥å£ï¼ˆé€šå¸¸ç»§æ‰¿è‡ªÂ `Binder`Â æˆ– AIDL ç”Ÿæˆçš„ Stubï¼‰ã€‚
- æœåŠ¡ç«¯é€šè¿‡Â `ServiceManager.addService()`Â æ³¨å†ŒæœåŠ¡ã€‚

### 2. å®¢æˆ·ç«¯è·å–æœåŠ¡

- å®¢æˆ·ç«¯ï¼ˆClientï¼‰é€šè¿‡Â `ServiceManager.getService()`Â è·å–æœåŠ¡çš„ Binder ä»£ç†å¯¹è±¡ï¼ˆProxyï¼‰ã€‚

### 3. è¿œç¨‹è°ƒç”¨

- å®¢æˆ·ç«¯è°ƒç”¨ Proxy çš„æ–¹æ³•ï¼ŒProxy ä¼šå°†è¯·æ±‚å‚æ•°æ‰“åŒ…æˆ Parcelï¼Œé€šè¿‡ Binder é©±åŠ¨å‘é€åˆ°æœåŠ¡ç«¯ã€‚
- Binder é©±åŠ¨è´Ÿè´£åœ¨å†…æ ¸ç©ºé—´å®‰å…¨åœ°è½¬å‘æ•°æ®ã€‚

### 4. æœåŠ¡ç«¯å¤„ç†

- æœåŠ¡ç«¯çš„ Stub æ¥æ”¶åˆ°è¯·æ±‚åï¼Œè§£åŒ…å‚æ•°ï¼Œæ‰§è¡Œå®é™…é€»è¾‘ï¼Œç„¶åå°†ç»“æœæ‰“åŒ…è¿”å›ã€‚

### 5. å®¢æˆ·ç«¯æ¥æ”¶ç»“æœ

- å®¢æˆ·ç«¯ Proxy è§£åŒ…è¿”å›å€¼ï¼Œå¾—åˆ°è°ƒç”¨ç»“æœã€‚

---

## 4. å…³é”®æŠ€æœ¯ç‚¹

- **é«˜æ•ˆ**ï¼šBinder é‡‡ç”¨å†…å­˜æ˜ å°„ï¼ˆmmapï¼‰å’Œé›¶æ‹·è´æŠ€æœ¯ï¼Œæ•°æ®ä¼ é€’æ•ˆç‡é«˜ã€‚
- **å®‰å…¨**ï¼šBinder é©±åŠ¨ä¼šæ ¡éªŒè°ƒç”¨è€… UID/PIDï¼Œæ”¯æŒæƒé™æ§åˆ¶ã€‚
- **å¼•ç”¨è®¡æ•°**ï¼šBinder æ”¯æŒå¯¹è±¡å¼•ç”¨è®¡æ•°ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚

---

## 5. ä»£ç ç¤ºæ„ï¼ˆAIDLï¼‰

**AIDL æ–‡ä»¶**

```aidl
// IMyService.aidl
interface IMyService {
    void sayHello();
}
```

**æœåŠ¡ç«¯å®ç°**

```java
public class MyService extends Service {
    private final IMyService.Stub mBinder = new IMyService.Stub() {
        public void sayHello() {
            // ä¸šåŠ¡é€»è¾‘
        }
    };

    public IBinder onBind(Intent intent) {
        return mBinder;
    }
}
```

**å®¢æˆ·ç«¯è°ƒç”¨**

```java
IMyService service = IMyService.Stub.asInterface(binder);
service.sayHello();
```

## RecyclerView å¦‚ä½•å¤ç”¨è§†å›¾ï¼Ÿ

### 1. ä¼ ç»Ÿ ListView çš„é—®é¢˜

- ListView é€šè¿‡Â `convertView`Â å¤ç”¨è§†å›¾ï¼Œä½†æœºåˆ¶è¾ƒä¸ºç®€å•ï¼Œçµæ´»æ€§æœ‰é™ã€‚

### 2. RecyclerView çš„å¤ç”¨æœºåˆ¶

RecyclerView é‡‡ç”¨äº†æ›´ä¸ºå®Œå–„çš„**â€œå›æ”¶æ± â€**ï¼ˆRecyclerï¼‰æœºåˆ¶ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š

#### ï¼ˆ1ï¼‰ViewHolder æœºåˆ¶

- æ¯ä¸ª item ç”±ä¸€ä¸ª ViewHolder å¯¹è±¡æŒæœ‰ï¼ŒViewHolder è´Ÿè´£ç¼“å­˜ itemView çš„å­æ§ä»¶å¼•ç”¨ï¼Œé¿å…é‡å¤ findViewByIdã€‚

#### ï¼ˆ2ï¼‰å›æ”¶æ± ï¼ˆRecyclerï¼‰

- RecyclerView å†…éƒ¨æœ‰ä¸€ä¸ª Recyclerï¼ˆå›æ”¶æ± ï¼‰ï¼Œç”¨äºå­˜æ”¾æ»‘å‡ºå±å¹•çš„ ViewHolderã€‚
- å½“éœ€è¦æ˜¾ç¤ºæ–°çš„ item æ—¶ï¼ŒRecyclerView ä¼šä¼˜å…ˆä»å›æ”¶æ± ä¸­å–å‡ºå¯ç”¨çš„ ViewHolder è¿›è¡Œå¤ç”¨ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½æ–°å»ºã€‚

#### ï¼ˆ3ï¼‰å¤ç”¨æµç¨‹

1. **æ»‘åŠ¨æ—¶ï¼Œéƒ¨åˆ† item æ»‘å‡ºå±å¹•**
   - å¯¹åº”çš„ ViewHolder è¢«ç§»é™¤å±å¹•ï¼Œæ”¾å…¥å›æ”¶æ± ã€‚
2. **éœ€è¦æ˜¾ç¤ºæ–° item æ—¶**
   - RecyclerView å…ˆä»å›æ”¶æ± æŸ¥æ‰¾æ˜¯å¦æœ‰å¯å¤ç”¨çš„ ViewHolderã€‚
   - æœ‰åˆ™å¤ç”¨ï¼Œæ²¡æœ‰åˆ™åˆ›å»ºæ–°çš„ ViewHolderã€‚
3. **ç»‘å®šæ•°æ®**
   - è°ƒç”¨ Adapter çš„Â `onBindViewHolder()`ï¼Œå°†æ–°æ•°æ®ç»‘å®šåˆ°å¤ç”¨çš„ ViewHolder ä¸Šã€‚

#### ï¼ˆ4ï¼‰å›æ”¶æ± çš„åˆ†ç±»

- å›æ”¶æ± ä¼šæ ¹æ® ViewType åˆ†ç±»å­˜å‚¨ä¸åŒç±»å‹çš„ ViewHolderï¼Œä¿è¯ä¸åŒç±»å‹çš„ item ä¸ä¼šæ··ç”¨ ViewHolderã€‚

---

### 3. å…³é”®æºç ç‰‡æ®µï¼ˆä¼ªä»£ç ï¼‰

```java
// è·å–å¯å¤ç”¨çš„ViewHolder
ViewHolder holder = recycler.getRecycledView(viewType);
if (holder == null) {
    // æ²¡æœ‰å¯ç”¨çš„ï¼Œåˆ›å»ºæ–°çš„
    holder = adapter.onCreateViewHolder(parent, viewType);
}
// ç»‘å®šæ•°æ®
adapter.onBindViewHolder(holder, position);
```

---

### 4. ä¼˜åŠ¿

- **é«˜æ•ˆ**ï¼šå¤§å¹…å‡å°‘äº† View çš„åˆ›å»ºå’Œé”€æ¯æ¬¡æ•°ï¼Œæå‡æ»‘åŠ¨æµç•…åº¦ã€‚
- **çµæ´»**ï¼šæ”¯æŒå¤šç§å¸ƒå±€ï¼ˆçº¿æ€§ã€ç½‘æ ¼ã€ç€‘å¸ƒæµç­‰ï¼‰ï¼Œæ”¯æŒåŠ¨ç”»å’Œè‡ªå®šä¹‰ Item è£…é¥°ã€‚
- **è§£è€¦**ï¼šAdapterã€LayoutManagerã€ItemAnimator ç­‰å„å¸å…¶èŒï¼Œæ˜“äºæ‰©å±•ã€‚

---

## 1. Handler å†…å­˜æ³„æ¼çš„æœ¬è´¨

### 1.1 Handler çš„å·¥ä½œåŸç†

- Handler é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessageQueueï¼‰å‘é€å’Œå¤„ç†æ¶ˆæ¯ï¼ˆMessageï¼‰ã€‚
- æ¯ä¸ª Message å†…éƒ¨æœ‰ä¸€ä¸ªÂ `target`Â å­—æ®µï¼ŒæŒ‡å‘å‘é€å®ƒçš„ Handlerã€‚
- Handler é€šå¸¸ä½œä¸º Activity æˆ– Fragment çš„å†…éƒ¨ç±»ï¼ˆåŒ¿åç±»æˆ–éé™æ€å†…éƒ¨ç±»ï¼‰ï¼Œ**ä¼šéšå¼æŒæœ‰å¤–éƒ¨ç±»çš„å¼•ç”¨**ã€‚

### 1.2 æ³„æ¼çš„å…¸å‹åœºæ™¯

- å¦‚æœ Handler å‘é€äº†ä¸€ä¸ªå»¶è¿Ÿæ¶ˆæ¯ï¼ˆå¦‚Â `postDelayed()`ï¼‰ï¼Œæ¶ˆæ¯ä¼šåœ¨ä¸€æ®µæ—¶é—´åæ‰è¢«å¤„ç†ã€‚
- è¿™æœŸé—´ï¼Œå¦‚æœ Activity å·²ç» finishï¼Œä½†æ¶ˆæ¯è¿˜åœ¨é˜Ÿåˆ—ä¸­ï¼Œ**Message æŒæœ‰ Handler çš„å¼•ç”¨ï¼ŒHandler åˆæŒæœ‰ Activity çš„å¼•ç”¨**ï¼Œå¯¼è‡´ Activity æ— æ³•è¢«å›æ”¶ï¼Œå‘ç”Ÿå†…å­˜æ³„æ¼ã€‚

---

activityé”€æ¯æ—¶æ¶ˆé™¤messagequeueä¸­æ‰€æœ‰ä»»åŠ¡

## 1. éé™æ€å†…éƒ¨ç±»/åŒ¿åç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨

- **åŸç†**ï¼šéé™æ€å†…éƒ¨ç±»å’ŒåŒ¿åç±»ä¼šéšå¼æŒæœ‰å¤–éƒ¨ç±»ï¼ˆå¦‚ Activityã€Fragmentï¼‰çš„å¼•ç”¨ã€‚
- **å¸¸è§åœºæ™¯**ï¼šHandlerã€Runnableã€Threadã€AsyncTask ç­‰ä½œä¸º Activity çš„å†…éƒ¨ç±»ï¼Œä»»åŠ¡æœªå®Œæˆæ—¶ Activity å·²é”€æ¯ï¼Œå¯¼è‡´æ— æ³•å›æ”¶ã€‚

**ç¤ºä¾‹**ï¼š

```java
public class MyActivity extends Activity {
    private Handler handler = new Handler() {
        // æŒæœ‰MyActivityå¼•ç”¨
    };
}
```

---

## 2. é™æ€é›†åˆæˆ–å•ä¾‹æŒæœ‰ Context

- **åŸç†**ï¼šé™æ€å˜é‡ç”Ÿå‘½å‘¨æœŸä¸åº”ç”¨ä¸€è‡´ï¼Œè‹¥æŒæœ‰ Activityã€View ç­‰ Contextï¼Œä¼šå¯¼è‡´å…¶æ— æ³•é‡Šæ”¾ã€‚
- **å¸¸è§åœºæ™¯**ï¼šå•ä¾‹æ¨¡å¼ä¸­ä¿å­˜äº† Activityã€Viewã€Context çš„å¼•ç”¨ã€‚

**ç¤ºä¾‹**ï¼š

```java
public class MyManager {
    private static Context context;
    public static void init(Context ctx) {
        context = ctx; // è‹¥ä¼ å…¥Activityï¼Œä¼šæ³„æ¼
    }
}
```

---

## 3. èµ„æºæœªå…³é—­æˆ–æœªé‡Šæ”¾

- **åŸç†**ï¼šæœªåŠæ—¶å…³é—­çš„èµ„æºï¼ˆå¦‚ Cursorã€Fileã€Streamã€Bitmap ç­‰ï¼‰ä¼šå ç”¨å†…å­˜ï¼Œå¯¼è‡´æ³„æ¼ã€‚
- **å¸¸è§åœºæ™¯**ï¼šæ•°æ®åº“ Cursorã€IO æµã€Bitmap æœªå›æ”¶ã€‚

**ç¤ºä¾‹**ï¼š

```java
Cursor cursor = db.query(...);
// æœªè°ƒç”¨ cursor.close()
```

---

## 4. ç›‘å¬å™¨ã€å›è°ƒæœªè§£é™¤æ³¨å†Œ

- **åŸç†**ï¼šæ³¨å†Œçš„ç›‘å¬å™¨ã€å›è°ƒç­‰å¦‚æœæœªåœ¨åˆé€‚æ—¶æœºè§£é™¤ï¼Œä¼šä¸€ç›´æŒæœ‰å¤–éƒ¨å¯¹è±¡å¼•ç”¨ã€‚
- **å¸¸è§åœºæ™¯**ï¼šBroadcastReceiverã€EventBusã€View.OnClickListenerã€ContentObserver ç­‰æœªæ³¨é”€ã€‚

**ç¤ºä¾‹**ï¼š

```java
// æ³¨å†Œå¹¿æ’­æœªæ³¨é”€
registerReceiver(receiver, filter);
// onDestroyæœªè°ƒç”¨unregisterReceiver
```

---

## 5. WebView/Bitmap/Drawable æ³„æ¼

- **WebView**ï¼šWebView å†…éƒ¨æŒæœ‰ Contextï¼Œå»ºè®®ç”¨ ApplicationContext æˆ–åœ¨é”€æ¯æ—¶è°ƒç”¨Â `webView.destroy()`ã€‚
- **Bitmap/Drawable**ï¼šå¤§å›¾ç‰‡æœªåŠæ—¶å›æ”¶ï¼Œæˆ– Drawable æŒæœ‰ Activity å¼•ç”¨ã€‚

---

## 6. Fragment æ³„æ¼

- Fragment ç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸å½“ï¼Œå¯¼è‡´ Fragment æˆ–å…¶ View æŒæœ‰ Activity çš„å¼•ç”¨ã€‚

---

## 7. Handler/MessageQueue æ³„æ¼

- Handler å‘é€å»¶è¿Ÿæ¶ˆæ¯ï¼ŒMessageQueue æŒæœ‰ Handlerï¼ŒHandler æŒæœ‰ Activityï¼Œå¯¼è‡´æ³„æ¼ã€‚

---

## 8. é™æ€ View æ³„æ¼

- é™æ€å˜é‡æŒæœ‰ Viewï¼Œä¼šå¯¼è‡´æ•´ä¸ª View æ ‘æ— æ³•é‡Šæ”¾ã€‚

---

## 9. çº¿ç¨‹æ³„æ¼

- é•¿æ—¶é—´è¿è¡Œçš„ Threadã€TimerTaskã€AsyncTask ç­‰æŒæœ‰ Activity/Fragment çš„å¼•ç”¨ï¼Œä»»åŠ¡æœªç»“æŸæ—¶é¡µé¢å·²é”€æ¯ã€‚

---

## 10. Context æ³„æ¼

- ä½¿ç”¨ ApplicationContext å¯ä»¥é¿å…å¾ˆå¤š Context æ³„æ¼é—®é¢˜ï¼Œä½†è¦æ³¨æ„ä¸èƒ½ç”¨ ApplicationContext æ›¿ä»£æ‰€æœ‰åœºæ™¯ï¼ˆå¦‚ UI ç›¸å…³æ“ä½œï¼‰ã€‚

---

## æ€»ç»“

**å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯å…³é”®è¯**ï¼š

- éé™æ€å†…éƒ¨ç±»/åŒ¿åç±»
- é™æ€å˜é‡/å•ä¾‹
- èµ„æºæœªå…³é—­
- ç›‘å¬å™¨/å›è°ƒæœªæ³¨é”€
- WebView/Bitmap/Drawable
- Handler/MessageQueue
- é™æ€ View
- çº¿ç¨‹æœªç»“æŸ
- Context æ³„æ¼

**é˜²æ­¢å†…å­˜æ³„æ¼çš„å»ºè®®**ï¼š

- é¿å…éé™æ€å†…éƒ¨ç±»é•¿æ—¶é—´æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨
- é™æ€å˜é‡/å•ä¾‹ä¸è¦æŒæœ‰ Activityã€View ç­‰çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡
- åŠæ—¶å…³é—­èµ„æºï¼Œæ³¨é”€ç›‘å¬å™¨
- ä½¿ç”¨ WeakReferenceã€ApplicationContext ç­‰æ–¹å¼é™ä½æ³„æ¼é£é™©
- åˆ©ç”¨ LeakCanary ç­‰å·¥å…·æ£€æµ‹æ³„æ¼

ä½ é—®çš„æ˜¯â€œç›‘å¬å™¨ã€å›è°ƒæœªè§£é™¤æ³¨å†Œâ€è¿™ä¸€ç±»å†…å­˜æ³„æ¼ä¸­çš„å¯¹è±¡ï¼ˆå¦‚ BroadcastReceiverã€EventBusã€View.OnClickListenerã€ContentObserver ç­‰ï¼‰ï¼Œ**åœ¨ä»€ä¹ˆæƒ…å†µä¸‹æ‰ä¼šé”€æ¯**ã€‚ä¸‹é¢è¯¦ç»†è¯´æ˜ï¼š

---

## 1. ç›‘å¬å™¨/å›è°ƒçš„ç”Ÿå‘½å‘¨æœŸ

### ï¼ˆ1ï¼‰æ³¨å†Œåï¼Œè°æŒæœ‰å¼•ç”¨ï¼Ÿ

- ä½ æ³¨å†Œç›‘å¬å™¨ï¼ˆå¦‚ BroadcastReceiverã€OnClickListenerï¼‰æ—¶ï¼Œç³»ç»Ÿæˆ–ç¬¬ä¸‰æ–¹åº“ä¼š**æŒæœ‰ä½ ä¼ å…¥å¯¹è±¡çš„å¼•ç”¨**ã€‚
- åªè¦è¿™ä¸ªå¼•ç”¨å­˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢« GC å›æ”¶ã€‚

### ï¼ˆ2ï¼‰ä»€ä¹ˆæ—¶å€™ä¼šé”€æ¯ï¼Ÿ

- **åªæœ‰åœ¨ä½ æ‰‹åŠ¨è§£é™¤æ³¨å†Œï¼ˆunregisterï¼‰åï¼Œç³»ç»Ÿ/åº“æ‰ä¼šé‡Šæ”¾å¯¹ç›‘å¬å™¨å¯¹è±¡çš„å¼•ç”¨**ã€‚
- è§£é™¤æ³¨å†Œåï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–åœ°æ–¹å¼•ç”¨å®ƒï¼Œç›‘å¬å™¨å¯¹è±¡å°±ä¼šè¢« GC å›æ”¶ã€‚

---

## 2. å¸¸è§åœºæ™¯åˆ†æ

### 2.1 BroadcastReceiver

- æ³¨å†Œåï¼Œç³»ç»ŸæŒæœ‰å¼•ç”¨ï¼Œåªæœ‰è°ƒç”¨Â `unregisterReceiver()`Â åï¼Œç³»ç»Ÿæ‰é‡Šæ”¾å¼•ç”¨ã€‚
- å¦‚æœ Activity å·²é”€æ¯ä½†æœªæ³¨é”€ï¼ŒBroadcastReceiver ä¾ç„¶è¢«ç³»ç»Ÿå¼•ç”¨ï¼Œå¯¼è‡´ Activity ä¹Ÿæ— æ³•è¢«å›æ”¶ã€‚

### 2.2 EventBus

- æ³¨å†Œåï¼ŒEventBus æŒæœ‰è®¢é˜…è€…å¯¹è±¡çš„å¼•ç”¨ï¼Œåªæœ‰è°ƒç”¨Â `unregister()`Â åæ‰é‡Šæ”¾ã€‚
- å¦åˆ™è®¢é˜…è€…ï¼ˆå¦‚ Activity/Fragmentï¼‰ä¼šä¸€ç›´è¢« EventBus æŒæœ‰ã€‚

### 2.3 View.OnClickListener

- View æŒæœ‰ OnClickListener çš„å¼•ç”¨ã€‚
- åªæœ‰ View è¢«é”€æ¯ï¼ˆå¦‚ Activity/Fragment çš„ View æ ‘è¢«é”€æ¯ï¼‰ï¼ŒListener æ‰ä¼šè¢«å›æ”¶ã€‚
- å¦‚æœ View æ˜¯é™æ€å˜é‡æˆ–é•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ï¼ŒListener ä¹Ÿä¸ä¼šè¢«å›æ”¶ã€‚

### 2.4 ContentObserver

- æ³¨å†Œåï¼Œç³»ç»ŸæŒæœ‰ Observer çš„å¼•ç”¨ï¼Œåªæœ‰è°ƒç”¨Â `unregisterContentObserver()`Â åæ‰é‡Šæ”¾ã€‚

---

## 3. å…¸å‹å†…å­˜æ³„æ¼åœºæ™¯

- **æœªæ‰‹åŠ¨è§£é™¤æ³¨å†Œ**ï¼šActivity/Fragment å·²é”€æ¯ï¼Œä½†ç›‘å¬å™¨/å›è°ƒè¿˜è¢«ç³»ç»Ÿæˆ–åº“æŒæœ‰å¼•ç”¨ï¼Œå¯¼è‡´æ— æ³•å›æ”¶ã€‚
- **é™æ€å˜é‡æŒæœ‰ View/Listener**ï¼šç”Ÿå‘½å‘¨æœŸè¿‡é•¿ï¼Œå¯¼è‡´æ³„æ¼ã€‚

---

## 4. æ€»ç»“

**åªæœ‰åœ¨ä½ ä¸»åŠ¨è§£é™¤æ³¨å†Œï¼ˆunregisterï¼‰ï¼Œæˆ–è€…æŒæœ‰ç›‘å¬å™¨å¼•ç”¨çš„å¯¹è±¡ï¼ˆå¦‚ Viewã€ç³»ç»ŸæœåŠ¡ã€ç¬¬ä¸‰æ–¹åº“ï¼‰æœ¬èº«è¢«é”€æ¯æ—¶ï¼Œç›‘å¬å™¨/å›è°ƒæ‰ä¼šè¢«é”€æ¯ã€‚**

**å¦åˆ™ï¼Œåªè¦æœ‰å¼•ç”¨å­˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢« GC å›æ”¶ï¼Œå®¹æ˜“å¯¼è‡´å†…å­˜æ³„æ¼ã€‚**

---

åºåˆ—å·ä½œç”¨

## 1. å”¯ä¸€æ ‡è¯†æ¯ä¸ªå­—èŠ‚çš„æ•°æ®

- TCPæ˜¯é¢å‘å­—èŠ‚æµçš„åè®®ï¼Œæ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¼šè¢«åˆ†å‰²æˆå¤šä¸ªæŠ¥æ–‡æ®µã€‚
- æ¯ä¸ªæŠ¥æ–‡æ®µéƒ½æœ‰ä¸€ä¸ªåºåˆ—å·ï¼ˆSequence Numberï¼‰ï¼Œ**ç”¨äºå”¯ä¸€æ ‡è¯†è¯¥æŠ¥æ–‡æ®µä¸­ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®åœ¨æ•´ä¸ªæ•°æ®æµä¸­çš„ä½ç½®**ã€‚

---

## 2. ä¿è¯æ•°æ®çš„æœ‰åºæ€§å’Œå®Œæ•´æ€§

- æ¥æ”¶æ–¹æ ¹æ®åºåˆ—å·å¯ä»¥å°†æ”¶åˆ°çš„æ•°æ®æŒ‰é¡ºåºé‡ç»„ï¼Œå³ä½¿æ•°æ®åŒ…ä¹±åºåˆ°è¾¾ï¼Œä¹Ÿèƒ½æ­£ç¡®è¿˜åŸåŸå§‹æ•°æ®æµã€‚
- å¦‚æœæŸä¸ªåºåˆ—å·çš„æ•°æ®ä¸¢å¤±ï¼Œæ¥æ”¶æ–¹å¯ä»¥é€šè¿‡ACKï¼ˆç¡®è®¤å·ï¼‰é€šçŸ¥å‘é€æ–¹é‡ä¼ ã€‚

---

## 3. é˜²æ­¢æ•°æ®åŒ…é‡å¤å’Œå¤±æ•ˆè¿æ¥è¯·æ±‚çš„å¹²æ‰°

- æ¯æ¬¡å»ºç«‹è¿æ¥æ—¶ï¼ŒåŒæ–¹éƒ½ä¼šé€‰æ‹©ä¸€ä¸ª**åˆå§‹åºåˆ—å·ï¼ˆISN, Initial Sequence Numberï¼‰**ï¼Œè¿™ä¸ªå€¼é€šå¸¸æ˜¯éšæœºç”Ÿæˆçš„ã€‚
- è¿™æ ·å¯ä»¥é˜²æ­¢å†å²è¿æ¥ä¸­çš„æ—§æ•°æ®åŒ…è¢«è¯¯è®¤ä¸ºæ˜¯å½“å‰è¿æ¥çš„æ•°æ®ï¼Œæå‡å®‰å…¨æ€§å’Œå¯é æ€§ã€‚

---

## 4. æ”¯æŒæµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶

- é€šè¿‡åºåˆ—å·å’Œç¡®è®¤å·ï¼ŒTCPå¯ä»¥å®ç°æ»‘åŠ¨çª—å£æœºåˆ¶ï¼Œè¿›è¡Œæµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶ï¼Œä¿è¯ç½‘ç»œä¼ è¾“çš„æ•ˆç‡å’Œç¨³å®šæ€§ã€‚

---

## 5. SYNåºåˆ—å·åœ¨ä¸‰æ¬¡æ¡æ‰‹ä¸­çš„ä½œç”¨

- åœ¨ä¸‰æ¬¡æ¡æ‰‹æ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åˆ†åˆ«å‘é€è‡ªå·±çš„SYNåºåˆ—å·ï¼Œå‘Šè¯‰å¯¹æ–¹â€œæˆ‘å‡†å¤‡ä»è¿™ä¸ªåºåˆ—å·å¼€å§‹å‘é€æ•°æ®â€ã€‚
- å¯¹æ–¹æ”¶åˆ°åï¼Œç”¨ACKç¡®è®¤è¿™ä¸ªåºåˆ—å·ï¼ŒåŒæ–¹å°±èƒ½æ­£ç¡®è¿½è¸ªå’Œç®¡ç†åç»­çš„æ•°æ®ä¼ è¾“ã€‚

è¿›ç¨‹éš”ç¦»ï¼šè™šæ‹Ÿå†…å­˜åœ°å€

è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼šç®¡é“é€šä¿¡ï¼Œå…±äº«å†…å­˜ï¼Œæ¶ˆæ¯é˜Ÿåˆ—

binderé€šä¿¡æœºåˆ¶ï¼šclient ï¼Œserviceï¼Œservicemanagerï¼Œbinderé©±åŠ¨

binderå†…å­˜ç®¡ç†ï¼šmmapå†…å­˜æ˜ å°„

è®¾è®¡æ¨¡å¼ ï¼šå•åˆ—æ¨¡å¼ï¼Œå·¥å‚æ¨¡å¼ï¼Œå»ºé€ è€…æ¨¡å¼ï¼Œè§‚å¯Ÿè€…æ¨¡å¼ï¼Œè´£ä»»é“¾æ¨¡å¼ï¼Œrecyclerview

mvc, mvp ,mvvm,mvi

## 2. ä¸ºä»€ä¹ˆåªæœ‰â€œåŸä½ç½®â€å’Œâ€œåŸä½ç½®+oldCapâ€ï¼Ÿ

### **åŸç†åˆ†æ**

å‡è®¾åŸæ•°ç»„é•¿åº¦ä¸º oldCapï¼Œæ‰©å®¹åæ–°æ•°ç»„é•¿åº¦ä¸º newCap = 2 Ã— oldCapã€‚

å¯¹äºæ¯ä¸ªå…ƒç´ ï¼ŒåŸæ¥çš„ä¸‹æ ‡æ˜¯ï¼š $$ index_{old} = hash & (oldCap - 1) $$

æ‰©å®¹åï¼Œä¸‹æ ‡å˜ä¸ºï¼š $$ index_{new} = hash & (newCap - 1) $$

ç”±äº newCap = 2 Ã— oldCapï¼Œæ‰€ä»¥ newCap - 1 = 2 Ã— oldCap - 1 = (oldCap << 1) - 1ã€‚

#### **äºŒè¿›åˆ¶åˆ†æ**

- oldCap - 1: ä½ä½å…¨1ï¼ˆæ¯”å¦‚ oldCap=16ï¼ŒoldCap-1=15ï¼ŒäºŒè¿›åˆ¶ 0000 1111ï¼‰
- newCap - 1: æ¯” oldCap-1 å¤šä¸€ä½1ï¼ˆæ¯”å¦‚ newCap=32ï¼ŒnewCap-1=31ï¼ŒäºŒè¿›åˆ¶ 0001 1111ï¼‰

**hash & (newCap - 1)**Â å…¶å®å°±æ˜¯æ¯” hash & (oldCap - 1) å¤šè€ƒè™‘äº†ä¸€ä½ï¼ˆoldCapä½ï¼‰ã€‚

- å¦‚æœ hash çš„ç¬¬ oldCap ä½æ˜¯ 0ï¼Œindex_new = index_old
- å¦‚æœ hash çš„ç¬¬ oldCap ä½æ˜¯ 1ï¼Œindex_new = index_old + oldCap

flow

åç¨‹å¼‚å¸¸å¤„ç†

sharedflow çƒ­æµï¼Œä¸€å¯¹å¤š

channel æ— è®¢é˜…è€…æ—¶æŒ‚èµ·ï¼Œä¿ç•™äº‹ä»¶ï¼Œä¸€å¯¹ä¸€

MVI å¯¹æ¯”MVVMçš„åŒºåˆ«ä¸»è¦åœ¨å“ª ï¼Ÿstateï¼Œaction ï¼Œeffect

1. MVVMå¹¶æ²¡æœ‰çº¦æŸViewå±‚ä¸ViewModelçš„äº¤äº’æ–¹å¼ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯Viewå±‚å¯ä»¥éšæ„è°ƒç”¨ViewModelä¸­çš„æ–¹æ³•ï¼Œè€ŒMVIæ¶æ„ä¸‹ViewModelçš„å®ç°å¯¹Viewå±‚å±è”½ï¼Œåªèƒ½é€šè¿‡å‘é€Intentæ¥é©±åŠ¨äº‹ä»¶ã€‚
2. MVVMæ¶æ„å¹¶ä¸å¼ºè°ƒå¯¹è¡¨å¾UIçŠ¶æ€çš„Modelå€¼æ”¶æ•›ï¼Œå¹¶ä¸”å¯¹èƒ½å½±å“UIçš„å€¼çš„ä¿®æ”¹å¯ä»¥æ•£å¸ƒåœ¨å„ä¸ªå¯è¢«ç›´æ¥è°ƒç”¨çš„æ–¹æ³•å†…éƒ¨ã€‚è€ŒMVIæ¶æ„ä¸‹ï¼ŒIntentæ˜¯é©±åŠ¨UIå˜åŒ–çš„å”¯ä¸€æ¥æºï¼Œå¹¶ä¸”è¡¨å¾UIçŠ¶æ€çš„å€¼æ”¶æ•›åœ¨ä¸€ä¸ªå˜é‡é‡Œ

flowæ“ä½œç¬¦

å¦‚ä½¿ç”¨flowOnæ“ä½œç¬¦åˆ‡æ¢åç¨‹ä¸Šä¸‹æ–‡ã€ä½¿ç”¨bufferã€conflateæ“ä½œç¬¦å¤„ç†èƒŒå‹ã€ä½¿ç”¨debounceæ“ä½œç¬¦å®ç°é˜²æŠ–ã€ä½¿ç”¨combineæ“ä½œç¬¦å®ç°flowçš„ç»„åˆç­‰ç­‰

1. flowOn â€”â€” åˆ‡æ¢ä¸Šæ¸¸æ‰§è¡Œçº¿ç¨‹

---

â€¢ ä½œç”¨ï¼šæŠŠ flow ä¸Šæ¸¸ï¼ˆç”Ÿäº§é˜¶æ®µï¼‰çš„æ‰§è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°æŒ‡å®šåç¨‹è°ƒåº¦å™¨ï¼›ä¸‹æ¸¸ç»§ç»­ä½¿ç”¨åŸè°ƒåº¦å™¨ã€‚  
â€¢ å…¸å‹åœºæ™¯ï¼šåœ¨ IO çº¿ç¨‹è¯»å–æ–‡ä»¶ï¼ç½‘ç»œï¼Œç„¶ååœ¨ UI çº¿ç¨‹æ”¶é›†å¹¶æ¸²æŸ“ã€‚

ç¤ºä¾‹ï¼š

```kotlin
val flow = flow {
    repeat(5) {
        emit(it)
        delay(100)        // æ¨¡æ‹Ÿè€—æ—¶ IO
    }
}.flowOn(Dispatchers.IO)  // ä¸Šæ¸¸æ”¾åˆ° IO çº¿ç¨‹æ‰§è¡Œ

scope.launch(Dispatchers.Main) {   // ä¸‹æ¸¸åœ¨ Main/UI çº¿ç¨‹
    flow.collect { value ->
        println("collect $value on ${Thread.currentThread().name}")
    }
}
```

---

2. buffer â€”â€” ç”Ÿäº§è€…-æ¶ˆè´¹è€…è§£è€¦ï¼ˆèƒŒå‹ç¼“å†²ï¼‰

---

â€¢ ä½œç”¨ï¼šç»™æµåŠ ä¸€ä¸ªç¼“å†²åŒºï¼Œå¹¶åœ¨ä¸åŒè°ƒåº¦å™¨ä¹‹é—´å¹¶å‘æ‰§è¡Œï¼›ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸ç”¨ä¸¥æ ¼ä¸€ä¸€å¯¹åº”ç­‰å¾…ã€‚  
â€¢ å…¸å‹åœºæ™¯ï¼šä¸Šæ¸¸å¾ˆå¿«ã€ä¸‹æ¸¸å¾ˆæ…¢ï¼Œæƒ³é€šè¿‡ç¼“å†²åŒºæŠ—ä¸€ä¸‹â€œèƒŒå‹â€ã€‚

ç¤ºä¾‹ï¼ˆæœª buffer ä¸ buffer å¯¹æ¯”ï¼‰ï¼š

```kotlin
val fastProducer = flow {
    repeat(10) {
        emit(it)
        println("emit $it")
    }
}.onEach { delay(50) }              // ä¸Šæ¸¸ 50 ms äº§ç”Ÿä¸€æ¬¡
  .flowOn(Dispatchers.Default)

// æ—  bufferï¼šæ¯æ¬¡ emit éƒ½è¦ç­‰ä¸‹æ¸¸å¤„ç†å®Œæˆ
fastProducer.collect { value ->
    delay(200)                      // ä¸‹æ¸¸å¤„ç†è¾ƒæ…¢
    println("collect $value")
}

// bufferï¼šä¸‹æ¸¸æ…¢ã€ä¸Šæ¸¸å¯ç»§ç»­å‘ï¼Œæœ€å¤šç¼“å­˜é»˜è®¤ 64 ä¸ª
fastProducer.buffer()
    .collect { value ->
        delay(200)
        println("collect $value")
    }
```

---

3. conflate â€”â€” æœ€æ–°å€¼è¦†ç›–æ—§å€¼

---

â€¢ ä½œç”¨ï¼šä¸ buffer ç±»ä¼¼ä¹Ÿæ˜¯è§£è€¦èƒŒå‹ï¼Œä½†æ˜¯åªä¿ç•™ç¼“å†²åŒºçš„â€œæœ€æ–°â€å…ƒç´ ï¼›ä¸­é—´å€¼è¢«ä¸¢å¼ƒã€‚  
â€¢ å…¸å‹åœºæ™¯ï¼šUI åˆ·æ–°ã€è¿›åº¦æ¡ï¼šåªéœ€è¦æœ€æ–°çŠ¶æ€ï¼Œä¸å¿…å¤„ç†å…¨éƒ¨å†å²ã€‚

ç¤ºä¾‹ï¼š

```kotlin
flow {
    repeat(5) {
        emit(it)           // 0,1,2,3,4
        delay(50)
    }
}
.conflate()                // æˆ– .buffer(Channel.CONFLATED)
.collect { value ->
    delay(150)             // æ¶ˆè´¹è€…æ…¢
    println("receive $value")   // è‡³å¤šæ‰“å° 0, ? , 4
}
```

---

4. debounce â€”â€” é™é»˜ä¸€æ®µæ—¶é—´åæ‰å‘å°„

---

â€¢ ä½œç”¨ï¼šå½“ä¸Šæ¸¸æŒç»­å¿«é€Ÿå‘å°„æ—¶ï¼Œåªåœ¨â€œæœ€è¿‘ä¸€æ¬¡å€¼äº§ç”Ÿåç»è¿‡æŒ‡å®šæ—¶é—´éƒ½æ²¡æœ‰æ–°å€¼â€æ—¶æ‰çœŸæ­£å‘å°„ï¼›å¸¸ç”¨äºæœç´¢æ¡†è¾“å…¥é˜²æŠ–ã€‚  
â€¢ å…¸å‹åœºæ™¯ï¼šæ–‡æœ¬è¾“å…¥ã€æŒ‰é’®ç‚¹å‡»ã€æ»šåŠ¨ç›‘å¬ç­‰ UI é˜²æŠ–ã€‚

ç¤ºä¾‹ï¼ˆ300 ms é˜²æŠ–ï¼‰ï¼š

```kotlin
val queryFlow = callbackFlow<String> {
    // å‡è®¾ editText.addTextChangedListener { trySend(it.toString()) }
}

queryFlow
    .debounce(300)          // 300 ms å†…æœ‰æ–°è¾“å…¥å°±é‡ç½®è®¡æ—¶
    .collect { keyword ->
        println("Start searching: $keyword")
    }
```

---

5. combine â€”â€” å¤šä¸ª Flow æŒ‰â€œæœ€æ–°â€é…å¯¹

---

â€¢ ä½œç”¨ï¼šæŠŠå¤šä¸ª Flow çš„â€œæœ€æ–°å€¼â€ç»„åˆæˆä¸€ä¸ªæ–°å€¼ï¼Œåªè¦ä»»æ„ä¸€ä¸ª Flow å‘å°„äº†æ–°å€¼å°±è§¦å‘ã€‚  
â€¢ å¯¹æ¯”ï¼š

- zipï¼šå¿…é¡»ä¸¤ä¸ª Flow åŒæ—¶æ‹¥æœ‰â€œä¸‹ä¸€å¯¹â€å…ƒç´ æ‰å‘å°„ï¼Œä¸€ä¸€é…å¯¹ã€‚
- combineï¼šç±»ä¼¼ RxJava çš„ combineLatestï¼Œè°å…ˆæ¥éƒ½è¡Œï¼Œç”¨å½¼æ­¤çš„â€œæœ€æ–°â€å…ƒç´ ã€‚

ç¤ºä¾‹ï¼ˆç”¨æˆ·å+å¯†ç è¾“å…¥æ ¡éªŒï¼‰ï¼š

```kotlin
val usernameFlow = callbackFlow<String> { /* ... */ }
val passwordFlow = callbackFlow<String> { /* ... */ }

usernameFlow
    .combine(passwordFlow) { u, p -> u to p }  // ä¹Ÿå¯å†™ combine(passwordFlow) { u, p -> "$u:$p" }
    .collect { (u, p) ->
        val enable = u.isNotBlank() && p.length >= 6
        loginButton.isEnabled = enable
    }
```

---

## å¯¹æ¯”é€ŸæŸ¥

â€¢ flowOnï¼šåªè´Ÿè´£åˆ‡æ¢â€œä¸Šæ¸¸â€åç¨‹ä¸Šä¸‹æ–‡ï¼Œä¸è§£å†³èƒŒå‹ã€‚  
â€¢ bufferï¼šå»ºç«‹é˜Ÿåˆ—ï¼Œå®Œæ•´ä¿ç•™é˜Ÿåˆ—ä¸­æ‰€æœ‰å…ƒç´ ã€‚  
â€¢ conflateï¼šå»ºç«‹å¤§å°ä¸º 1 çš„â€œæœ€æ–°å€¼â€ç¼“å†²åŒºï¼Œä¸­é—´å€¼ä¼šè¢«ä¸¢å¼ƒã€‚  
â€¢ debounceï¼šåŸºäºæ—¶é—´çª—å£ï¼Œåªæœ‰åœé¡¿æœŸåˆ°æ¥æ‰å‘å°„ã€‚  
â€¢ combineï¼šæŠŠå¤šä¸ª Flow çš„â€œæœ€æ–°å€¼â€å®æ—¶åˆå¹¶

1. åç¨‹æ˜¯ä»€ä¹ˆ  
   â€¢ Kotlin åç¨‹æ˜¯ä¸€ç§è½»é‡çº§çš„å¹¶å‘å®ç°ï¼Œå¯çœ‹ä½œâ€œå¯æŒ‚èµ·çš„å‡½æ•°â€ã€‚  
   â€¢ ç›¸æ¯”çº¿ç¨‹ï¼Œåç¨‹çš„åˆ›å»ºå’Œåˆ‡æ¢å¼€é”€å°å¾—å¤šï¼Œå¯åœ¨åŒä¸€çº¿ç¨‹ä¸Šæˆåƒä¸Šä¸‡åœ°è¿è¡Œã€‚  
   â€¢ åç¨‹ä¾èµ–äºæŒ‚èµ·å‡½æ•°å’Œåç¨‹è°ƒåº¦å™¨ï¼Œå®ç°éé˜»å¡å¼çš„å¹¶å‘é€»è¾‘ã€‚

2. åŸºæœ¬æ¦‚å¿µ  
   â€¢ æŒ‚èµ·å‡½æ•°ï¼ˆsuspendï¼‰ï¼šç”¨ suspend å…³é”®å­—ä¿®é¥°ï¼Œå¯åœ¨åç¨‹å†…â€œæŒ‚èµ·â€å½“å‰æ‰§è¡Œå¹¶è®©å‡ºçº¿ç¨‹ã€‚  
   â€¢ åç¨‹ä½œç”¨åŸŸï¼ˆCoroutineScopeï¼‰ï¼šå†³å®šåç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¸¸è§æœ‰ GlobalScopeã€CoroutineScopeã€lifecycleScope ç­‰ã€‚  
   â€¢ åç¨‹æ„å»ºå™¨ï¼š
   
   - launchï¼šè¿”å› Jobï¼Œä¸æºå¸¦ç»“æœï¼Œä¾§é‡â€œåšæŸäº‹â€ã€‚
   - asyncï¼šè¿”å› Deferredï¼Œå¯é€šè¿‡ await() è·å–ç»“æœï¼Œä¾§é‡â€œè®¡ç®—æŸå€¼â€ã€‚
   - runBlockingï¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œé€šå¸¸ä»…åœ¨ main æ–¹æ³•æˆ–å•å…ƒæµ‹è¯•ä¸­ä½¿ç”¨ã€‚  
     â€¢ è°ƒåº¦å™¨ï¼ˆDispatcherï¼‰ï¼š
   - Dispatchers.Defaultï¼šé€‚åˆ CPU å¯†é›†å‹ä»»åŠ¡ï¼ˆé»˜è®¤çº¿ç¨‹æ± ï¼‰ã€‚
   - Dispatchers.IOï¼šé€‚åˆ I/O å¯†é›†å‹ä»»åŠ¡ï¼Œå¦‚æ–‡ä»¶/ç½‘ç»œæ“ä½œã€‚
   - Dispatchers.Mainï¼šAndroid UI çº¿ç¨‹ï¼ˆä»…é™ Androidï¼‰ã€‚
   - Dispatchers.Unconfinedï¼šä¸å—é™çº¿ç¨‹ï¼Œå…ˆåœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œï¼Œé‡åˆ°æŒ‚èµ·åå†æ ¹æ®æŒ‚èµ·ç‚¹çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚

3. å…¸å‹ç¤ºä¾‹

```kotlin
fun main() = runBlocking {
    val job1 = launch {
        repeat(5) { i ->
            println("launch: $i")
            delay(200) // æŒ‚èµ· 200 msï¼Œè€Œä¸æ˜¯é˜»å¡çº¿ç¨‹
        }
    }

    val deferred = async(Dispatchers.Default) {
        // è®¡ç®— Fibonacci(30) ä¹‹ç±»çš„ CPU å¯†é›†å‹ä»»åŠ¡
        fib(30)
    }

    println("Fibonacci = ${deferred.await()}") // ç­‰å¾…ç»“æœ
    job1.join() // ç­‰å¾…å­åç¨‹ç»“æŸ
}

// é€’å½’æ–æ³¢é‚£å¥‘
fun fib(n: Int): Int = if (n <= 1) n else fib(n - 1) + fib(n - 2)
```

4. å–æ¶ˆä¸å¼‚å¸¸å¤„ç†  
   â€¢ åç¨‹å¯é€šè¿‡ Job.cancel()ã€CoroutineScope.cancel() ç­‰æ–¹å¼å–æ¶ˆã€‚  
   â€¢ æŒ‚èµ·ç‚¹ä¼šå®šæœŸæ£€æŸ¥åç¨‹æ˜¯å¦è¢«å–æ¶ˆå¹¶æŠ›å‡º CancellationExceptionã€‚  
   â€¢ try/catch/finally æ•è·å¼‚å¸¸å¹¶å¯åœ¨ finally ä¸­è°ƒç”¨ coroutineContext.cancel()ã€‚ï¼ˆæ³¨æ„ï¼šCancellationException é€šå¸¸ä¼šè¢«å¿½ç•¥ï¼Œéœ€è¦æ˜¾å¼å¤„ç†å…¶ä»–å¼‚å¸¸ã€‚ï¼‰

```kotlin
val job = launch {
    try {
        repeat(1000) { i ->
            println("I'm sleeping $i ...")
            delay(500)
        }
    } finally {
        println("Finally, I'm cancelled")
    }
}
delay(1300)
job.cancelAndJoin()
```

5. ç»“æ„åŒ–å¹¶å‘  
   â€¢ å­åç¨‹é»˜è®¤ç»§æ‰¿çˆ¶ä½œç”¨åŸŸï¼Œçˆ¶ä½œç”¨åŸŸå–æ¶ˆæ—¶ä¼šè‡ªåŠ¨å–æ¶ˆæ‰€æœ‰å­åç¨‹ã€‚  
   â€¢ ä½¿ç”¨ coroutineScope { â€¦ } æˆ– supervisorScope { â€¦ } ç®¡ç†åç¨‹å±‚çº§å¯ç¡®ä¿å¼‚å¸¸æ­£ç¡®ä¼ æ’­å’Œèµ„æºè‡ªåŠ¨å›æ”¶ã€‚

6. Flowï¼ˆå“åº”å¼æ•°æ®æµï¼‰  
   â€¢ FlowÂ ç”¨äºå¼‚æ­¥æ•°æ®æµï¼Œæ”¯æŒèƒŒå‹ã€å–æ¶ˆã€å¼‚å¸¸å¤„ç†ã€‚  
   â€¢ å¸¸ç”¨æ“ä½œç¬¦ï¼šmapã€filterã€collectã€bufferã€conflateã€flatMapMerge ç­‰ã€‚

```k
fun simpleFlow() = flow {
    for (i in 1..3) {
        delay(100)
        emit(i)
    }
}

runBlocking {
    simpleFlow()
        .map { it * it }
        .collect { println(it) }
}
```



apkåŒ…ä¼˜åŒ–æ‰‹æ®µ

Android APK å‡åŒ…Â 



## 1. æ¦‚è¿°

ç»è¿‡10å¤šå¹´çš„å‘å±•ï¼Œæ‰‹æœºåº”ç”¨é€æ¸å‘å¤§è€Œå…¨çš„æ–¹å‘è¿›è¡Œå‘å±•ï¼Œå¯¼è‡´ APK åŒ…çš„å¤§å°ä¸æ–­å¢å¤§ï¼Œä»¥ QQ éŸ³ä¹ä¸ºä¾‹ï¼Œå·²ç»ä»æœ€å¼€å§‹å•çº¯çš„éŸ³ä¹æ’­æ”¾å™¨åˆ°ç°åœ¨é›†éŸ³ä¹ã€ç›´æ’­ã€æ¸¸æˆã€å® ç‰©ã€éŸ³ä¹ç©ºé—´äºä¸€ä½“ï¼Œè¿™äº›éƒ½æ¨åŠ¨ç€ APK ä¸æ–­è†¨èƒ€ã€‚

2. APK ç»„æˆ

![](https://km.woa.com/asset/9447d92ad76d4f879733d8881fc056d1?height=482&width=522&imageMogr2/thumbnail/1540x%3E/ignore-error/1)

å¯ä»¥çœ‹åˆ° APK çš„ç»„æˆä¸»è¦ç”±ä¸Šè¿°å‡ éƒ¨åˆ†ç»„æˆï¼Œé‚£ä¹ˆé’ˆå¯¹ APK å¤§å°çš„ä¼˜åŒ–ä¹Ÿå°†å›´ç»•ç€ä¸Šè¿°å‡ ä¸ªéƒ¨åˆ†å±•å¼€ã€‚

3. APK å¤§å°ä¼˜åŒ–

APK ä¼˜åŒ–ä¸€ç›´æ˜¯ Android æ€§èƒ½ä¼˜åŒ–çš„ä¸€ä¸ªæ–¹å‘ï¼Œæ ¹æ® Google Play å‘å¸ƒçš„æ•°æ®ï¼Œæ¯å‡å°‘ 10M çš„ APK å¤§å°åœ¨ä¸åŒåœ°åŒºæ‰€å¸¦æ¥çš„ç”¨æˆ·å¢é•¿ç‡å¦‚ä¸‹ï¼š

![](https://km.woa.com/asset/4c60205068284ab09f353baa06a39c37?height=724&width=1198&imageMogr2/thumbnail/1540x%3E/ignore-error/1)

> å¯ä»¥çœ‹åˆ°æ¯å‡å°‘ 10M çš„ APK å¤§å°ï¼Œå¹³å‡å¯ä»¥å¸¦æ¥ 1.6% çš„ç”¨æˆ·è½¬åŒ–ç‡ã€‚

é’ˆå¯¹ APK å¤§å°çš„ä¼˜åŒ–æ— å¤–ä¹ 3 ä¸ªæ–¹å‘ï¼š

> 1. åˆ é™¤  
> 2. å‹ç¼©  
> 3. åŠ¨æ€åŠ è½½

æ¥ä¸‹æ¥æˆ‘ä»¬ä» APK çš„å„ä¸ªç»„æˆéƒ¨åˆ†æ¥åˆ†åˆ«è°ˆè°ˆæ ¼å„è‡ªçš„ä¼˜åŒ–æ‰‹æ®µã€‚

3.1 res & resources.arsc èµ„æºä¼˜åŒ–



3.1.1 æ— ç”¨èµ„æºæ¸…ç†

```javascript
release {
    minifyEnabled true // å¼€å¯ä»£ç æ··æ·†
    shrinkResources true // å»æ‰æ— ç”¨èµ„æºï¼Œéœ€è¦ä¾èµ– minifyEnabled = trueï¼Œå› ä¸ºè¦çŸ¥é“æ˜¯å¦è¢«å¼•ç”¨
}
```

3.1.2 å¤šè¯­è¨€ä¼˜åŒ–

```javascript
android {
    defaultConfig {
         ...
        resConfigs "en" // åªä¿ç•™è‹±æ–‡
    }
}
```

æ‰“åŒ…çš„æ—¶å€™åªä¼šä¿ç•™æŒ‡å®šçš„è¯­è¨€ï¼Œå¦‚æœæœ¬èº«åº”ç”¨åªæ˜¯ç”¨äºå›½å†…ï¼Œè¿™é‡Œä¹Ÿæœ€å¥½åŠ ä¸Šï¼Œå› ä¸º Android å¾ˆå¤šç³»ç»Ÿåº“é€‚é…äº†å¤šè¯­è¨€ï¼Œ**åŠ ä¸Šè¿™ä¸ªå¯ä»¥ä¼˜åŒ–æ‰å…¶ä»–ç¬¬ä¸‰æ–¹åº“ä¸­åŒ…å«çš„å¤šè¯­è¨€ä¿¡æ¯**ã€‚

#### 3.1.3 èµ„æºå‹ç¼©

[ğŸ‘‰ AndResGuard Github åœ°å€](https://github.com/shwenzhang/AndResGuard)ï¼ŒAndResGuard å®ç°äº†å¦‚ä¸‹åŠŸèƒ½ï¼š

> 1. é€šè¿‡ md5 å¯¹æ¯”ï¼Œæ¥åˆ¤æ–­é‡å¤æ–‡ä»¶ï¼Œæ”¯æŒåˆå¹¶é‡å¤èµ„æº  
> 2. å¯¹èµ„æºæ–‡ä»¶åç§°è¿›è¡Œç¼©çŸ­  
> 3. å¯¹ APK ä¸­çš„å†…å®¹é‡‡ç”¨ 7zip å‹ç¼©

é€šè¿‡ä¸Šè¿°ä¼˜åŒ–ï¼ŒAPK ä¼˜åŒ–å¯ä»¥è¾¾åˆ°éå¸¸å¯è§‚çš„æ”¶ç›Šã€‚



**3.1.4 å›¾ç‰‡å‹ç¼©**

å›¾ç‰‡ç»å¯¹æ˜¯æ•´ä¸ªå·¥ç¨‹å æ¯”éå¸¸å¤§çš„èµ„æºï¼Œå› æ­¤é’ˆå¯¹å›¾ç‰‡å‹ç¼©æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„å‡åŒ…æ‰‹æ®µï¼ŒQQ éŸ³ä¹é‡‡ç”¨äº†Â [pngquant](https://pngquant.org/)Â ä¸Â [cwebp](https://developers.google.com/speed/webp/docs/cwebp?hl=zh-cn)Â ä¸¤ç§æ–¹å¼å¯¹å·¥ç¨‹ä¸­çš„å›¾ç‰‡è¿›è¡Œå‹ç¼©ä¼˜åŒ–ã€‚

> pngquantï¼šç”¨äºå‹ç¼© png å›¾ç‰‡  
> cwebpï¼šå°† pngã€jpg å›¾ç‰‡è½¬æˆ webp å›¾ç‰‡æ ¼å¼

å…·ä½“ç ”ç©¶å¯ä»¥å‚è€ƒï¼š[QQéŸ³ä¹Androidç«¯WebPæ¢ç´¢ä¹‹è·¯](https://km.woa.com/group/34300/articles/show/453190)



**3.1.5 èµ„æºåŠ¨æ€åŠ è½½**

æ™®éæ¥è¯´ res ä¸­çš„èµ„æºåº”è¯¥æ¯”è¾ƒå°ï¼Œå¦‚æœå¤ªå¤§è¿™ä¸ªä»æºå¤´ä¸Šå°±åº”è¯¥æƒ³åŠæ³•å»ä¼˜åŒ–äº†ï¼Œå•ç‹¬å¯¹è¿™é‡ŒåšåŠ¨æ€åŠ è½½ä¹Ÿæ˜¯å¯ä»¥ï¼Œä½†æ˜¯ä¸å¦‚æ’ä»¶åŒ–æ¥çš„å½»åº•ã€‚

#### 3.1.6 èµ„æºäºŒè¿›åˆ¶ç²¾ç®€

å¯ä»¥å‚è€ƒå­—èŠ‚çš„ç ”ç©¶æ–‡ç« ï¼š[æŠ–éŸ³ Android åŒ…ä½“ç§¯ä¼˜åŒ–æ¢ç´¢ï¼šèµ„æºäºŒè¿›åˆ¶æ ¼å¼çš„æè‡´ç²¾ç®€](https://juejin.cn/post/7096077413871943688)

è¿™è¾¹æ–‡ç« æ˜¯åŸºäº AndResGuard ä¸Šå¯¹äºŒè¿›åˆ¶èµ„æºåšäº†æ›´åŠ æ·±å…¥çš„æ¢ç©¶ï¼ŒåŒæ—¶å¯¹ layout ä¹Ÿè¿›è¡Œäº†ä¼˜åŒ–ï¼Œä»å­—èŠ‚ä¼˜åŒ–æ•ˆæœæ¥çœ‹æŒºä¸é”™ã€‚

### 3.2 assets èµ„æºä¼˜åŒ–

è¿™ä¸ªéƒ¨åˆ†å…¶å®è·Ÿ res éƒ¨åˆ†çš„ä¼˜åŒ–å·®ä¸å¤šï¼Œä¹Ÿæ˜¯å¯ä»¥å¯¹å…¶ä¸­çš„éƒ¨åˆ†å›¾ç‰‡ï¼ˆæ¯”å¦‚ lottie å›¾ç‰‡èµ„æºï¼‰è¿›è¡Œå‹ç¼©ï¼Œç„¶åé’ˆå¯¹èµ„æºè¿›è¡ŒåŠ¨æ€åŠ è½½ï¼Œè¿™é‡Œä¸å¤šåšèµ˜è¿°ã€‚

### 3.3 lib èµ„æºä¼˜åŒ–

#### 3.3.1 ä¿ç•™ä¸€ç§ ABI



ç›®å‰ Android å®˜ç½‘ä¸Šä¹Ÿæ›´æ–°äº†æœ€æ–° ABI ä¿¡æ¯ï¼š



[ğŸ‘‰ NDKå„ç‰ˆæœ¬å‘å¸ƒæ—¶é—´](https://developer.android.com/ndk/downloads/revision_history?hl=zh-cn)

è€Œä¸€éƒ¨è®¾å¤‡å¾€å¾€åªéœ€è¦ä¿ç•™ä¸€å¥—å³å¯ï¼Œé€šå¸¸æˆ‘ä»¬åªéœ€è¦ä¿ç•™Â `armeabi-v7a`ï¼Œå¯ä»¥é€šè¿‡ NDK çš„é…ç½®å³å¯ï¼š

```javascript
ndk {
    abiFilters 'armeabi-v7a'
}
```

ç›®å‰å¾ˆå¤šåº”ç”¨å¸‚åœºä¹Ÿæ”¯æŒ arm64 çš„åŒ…ä¸Šä¼ äº†ï¼Œè¿™é‡Œæ ¹æ®éœ€è¦è°ƒæ•´å³å¯ã€‚

#### 3.3.2 so åŠ¨æ€åŠ è½½

ç”±äº Android æ”¯æŒé€šè¿‡Â `System.load(path: String)`å»åŠ è½½å¯¹åº”è·¯å¾„ä¸Šçš„ soï¼Œæ‰€ä»¥åŸºäºæ­¤æˆ‘ä»¬å®ç°äº†ä¸€å¥—è‡ªåŠ¨åŒ–çš„ so åŠ¨æ€åŠ è½½é…ç½®ï¼š

```javascript
SoUpload {
    // éæœ¬åœ°ç¯å¢ƒæ‰æ‰“å¼€
    enable = !isLocalEnv

    // å‰é¢ä»£è¡¨å¯¹åº”çš„ so åç§°ï¼Œåé¢ä»£è¡¨æ˜¯å¦è¦ä» APK ä»åˆ é™¤
    soUploadMap = [
            "ijkplayer": false,
            "tensorflowlite_jni": true
    ]
}
```

ä¸Šè¿° soUploadMap ä¸­é…ç½®çš„ so éƒ½ä¼šåœ¨æ‰“åŒ…çš„æ—¶å€™è‡ªåŠ¨ä¸Šä¼ è¿œç«¯ï¼Œå¦‚æœé…ç½®çš„æ˜¯ true åˆ™è¡¨ç¤ºå¯¹åº”çš„ so ä¼šåœ¨æ‰“åŒ…é˜¶æ®µè¢«åˆ é™¤ã€‚

> é’ˆå¯¹ false çš„æƒ…å†µæ˜¯æˆ‘ä»¬å‘ç°ä¸€äº› so æ˜æ˜å·²ç»è¢«æ‰“åˆ°åŒ…é‡Œäº†ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šæœ‰æœ¬åœ°æ‰¾ä¸åˆ°ä»è€Œå¼‚å¸¸çš„åœºæ™¯ï¼Œè¿™é‡Œåšä¸ªä¿åº•ã€‚

#### 3.3.3 so ç¼–è¯‘ flag ä¼˜åŒ–

å¯ä»¥å‚è€ƒç¾å›¢åœ¨è¿™æ–¹é¢åšçš„ç ”ç©¶ï¼š[Androidå¯¹soä½“ç§¯ä¼˜åŒ–çš„æ¢ç´¢ä¸å®è·µ](https://tech.meituan.com/2022/06/02/meituans-technical-exploration-and-practice-of-android-so-volume-optimization.html)

#### 3.3.4 so é‡‡ç”¨ 7zip å‹ç¼©

è¢«æ‰“åŒ…åˆ° APK ä¸­çš„ so è™½ç„¶æ˜¯è¢«å‹ç¼©è¿‡çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å…¶å®å¯ä»¥è€ƒè™‘ç”¨æ›´é«˜å‹ç¼©ç‡çš„ 7zip è¿›è¡Œå‹ç¼©ï¼Œä¹‹å‰æœ‰æµ‹è¯•è¿‡å°† QQ éŸ³ä¹æ‰€æœ‰çš„ so è¿›è¡Œ 7zip å‹ç¼©åï¼Œå¤§æ¦‚å¯ä»¥å‡å°‘Â `15M`Â å·¦å³çš„å¤§å°ï¼Œåªä¸è¿‡åœ¨åŠ è½½æ—¶éœ€è¦æˆ‘ä»¬é¢å¤–åšä¸€æ­¥è§£å‹å¤„ç†ã€‚

> 1. å®ç° so æ–°çš„åŠ è½½æ–¹å¼ï¼Œæ”¯æŒåŠ è½½æ—¶è§£å‹ç¼© 7zip çš„ so  
> 2. æ›¿æ¢æ‰€æœ‰çš„ System.loadLibrary ä¸ºæˆ‘ä»¬æ–°çš„åŠ è½½æ–¹æ³•

å½“ç„¶é’ˆå¯¹é‡è¦æˆ–è€…æ€§èƒ½è¦æ±‚æ¯”è¾ƒé«˜çš„ so è¦æ…é‡ï¼Œå…¶ä»–çš„å¯ä»¥åšä¸ªè§£å‹åçš„ç¼“å­˜ï¼Œ7zip å‹ç¼©é…åˆåŠ¨æ€åŠ è½½å…¶å®æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚

### 3.4 dex å¤§å°ä¼˜åŒ–

#### 3.4.1 ä»£ç æ··æ·†

```javascript
release {
    minifyEnabled true // å¼€å¯ä»£ç æ··æ·†
}
```

é»˜è®¤å¼€å¯ R8ï¼ŒR8 ç›¸è¾ƒäº D8 ä¼˜åŒ–çš„æ•ˆæœæ›´å¥½ã€‚

#### 3.4.2 å­—èŠ‚ç ä¼˜åŒ–

å‚è€ƒï¼š[æŠ–éŸ³AndroidåŒ…ä½“ç§¯ä¼˜åŒ–æ¢ç´¢ï¼šä»Classå­—èŠ‚ç å…¥æ‰‹ç²¾ç®€DEXä½“ç§¯](https://mp.weixin.qq.com/s/npT9MW4TQWH--fKsC_3NCQ)

### 3.5 META-INF ä¼˜åŒ–

ç”±äº META-INF ä¸­å å¤§å¤´çš„ä¸»è¦æ˜¯è®°å½•å„ä¸ªæ–‡ä»¶çš„ SHA-1 å€¼ï¼Œé€šè¿‡ AndResGuard å°†æ–‡ä»¶åç§°ç¼©çŸ­åï¼Œå¯ä»¥å¤§å¤§å‡å°‘å¯¹åº”æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œä»è€Œè¾¾åˆ°ä¼˜åŒ– META-INF çš„ç›®çš„ã€‚

## 4. åè®°

Android APK å¤§å°ä¼˜åŒ–å·²ç„¶è¿›å…¥åˆ°æ·±æ°´åŒºï¼Œ è¿™é‡Œä»‹ç»äº†å½“å‰é’ˆå¯¹ APK ä¼˜åŒ–çš„å„ç§æ‰‹æ®µï¼Œä»…ä¾›å„ä½å°ä¼™ä¼´å‚è€ƒã€‚
